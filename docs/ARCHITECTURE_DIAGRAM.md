# ì½˜ì„œíŠ¸ ì˜ˆì•½ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

ì´ ë¬¸ì„œëŠ” ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ë¥¼ ì‹œê°ì ìœ¼ë¡œ ì„¤ëª…í•˜ëŠ” ë‹¤ì´ì–´ê·¸ë¨ íŒŒì¼ë“¤ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.

> **ğŸ“Œ Note**: VS Codeì—ì„œ `.mmd` íŒŒì¼ì„ ë¯¸ë¦¬ë³´ê¸°í•˜ë ¤ë©´ Mermaid í™•ì¥ì„ ì„¤ì¹˜í•˜ì„¸ìš”.

---

## ğŸ“ ë‹¤ì´ì–´ê·¸ë¨ íŒŒì¼ ëª©ë¡

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| [architecture-flowchart.mmd](./architecture-flowchart.mmd) | ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ í”Œë¡œìš°ì°¨íŠ¸ |
| [er-diagram.mmd](./er-diagram.mmd) | ë°ì´í„°ë² ì´ìŠ¤ ER ë‹¤ì´ì–´ê·¸ë¨ (6ê°œ í…Œì´ë¸”) |
| [reservation-flow.mmd](./reservation-flow.mmd) | ì˜ˆì•½-ê²°ì œ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ |
| [domain-pattern.mmd](./domain-pattern.mmd) | Clean vs Layered ì•„í‚¤í…ì²˜ íŒ¨í„´ ë¹„êµ |
| [scheduler-flow.mmd](./scheduler-flow.mmd) | ìŠ¤ì¼€ì¤„ëŸ¬ ë°°ì¹˜ ì²˜ë¦¬ í”Œë¡œìš° |

---

## 1. ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

ğŸ“„ **íŒŒì¼**: `architecture-flowchart.mmd`

ì‹œìŠ¤í…œì˜ ì „ì²´ êµ¬ì¡°ë¥¼ ë³´ì—¬ì£¼ëŠ” í”Œë¡œìš°ì°¨íŠ¸ì…ë‹ˆë‹¤:
- **Presentation Layer**: API ì»¨íŠ¸ë¡¤ëŸ¬ë“¤
- **Application Layer**: UseCase(Clean Architecture) / Service(Layered Architecture)
- **Domain Layer**: ë„ë©”ì¸ ì—”í‹°í‹°ì™€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
- **Infrastructure Layer**: JPA Repository êµ¬í˜„ì²´

---

## 2. ë°ì´í„°ë² ì´ìŠ¤ ER ë‹¤ì´ì–´ê·¸ë¨

ğŸ“„ **íŒŒì¼**: `er-diagram.mmd`

6ê°œ í…Œì´ë¸” ê°„ì˜ ê´€ê³„ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Concert   â”‚â”€â”€â”€â”€<â”‚   Seat      â”‚â”€â”€â”€â”€<â”‚ Reservation â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PointBalance â”‚     â”‚PointHistory â”‚     â”‚   Payment   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â–²
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ì˜ˆì•½-ê²°ì œ í”Œë¡œìš°

ğŸ“„ **íŒŒì¼**: `reservation-flow.mmd`

ì˜ˆì•½ë¶€í„° ê²°ì œê¹Œì§€ì˜ ì‹œí€€ìŠ¤:
1. ì¢Œì„ ì¡°íšŒ ë° ì ê¸ˆ (Pessimistic Lock)
2. ì˜ˆì•½ ìƒì„± (PENDING ìƒíƒœ)
3. í¬ì¸íŠ¸ ì°¨ê° (Optimistic Lock)
4. ê²°ì œ ì™„ë£Œ ë° ìƒíƒœ ë³€ê²½

---

## 4. ì•„í‚¤í…ì²˜ íŒ¨í„´ ë¹„êµ

ğŸ“„ **íŒŒì¼**: `domain-pattern.mmd`

### Clean Architecture (Reservation, Payment)
```
Controller â†’ UseCase Interface â†’ UseCase Impl â†’ Domain/Repository
```

### Layered Architecture (Concert, Point, Queue)
```
Controller â†’ Service â†’ Repository
```

---

## 5. ìŠ¤ì¼€ì¤„ëŸ¬ ë°°ì¹˜ ì²˜ë¦¬

ğŸ“„ **íŒŒì¼**: `scheduler-flow.mmd`

3ê°œì˜ ìŠ¤ì¼€ì¤„ëŸ¬ ë™ì‘ ë°©ì‹:
- **QueueScheduler**: ëŒ€ê¸°ì—´ í™œì„±í™”/ë§Œë£Œ (Bulk Update)
- **ReservationExpirationScheduler**: ì˜ˆì•½ ë§Œë£Œ ì²˜ë¦¬ (Bulk Update)
- **PaymentScheduler**: ê²°ì œ ì™„ë£Œ ì²˜ë¦¬

---

## ğŸ”§ ì„±ëŠ¥ ìµœì í™” í¬ì¸íŠ¸

ë‹¤ì´ì–´ê·¸ë¨ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ì„±ëŠ¥ ìµœì í™”:

1. **Bulk Update**: ìŠ¤ì¼€ì¤„ëŸ¬ì—ì„œ N+1 ë¬¸ì œ í•´ê²°
2. **Index**: Seat, Reservation, QueueTokenì— ì¸ë±ìŠ¤ ì¶”ê°€
3. **Lock ì „ëµ**:
   - Pessimistic Lock: ì¢Œì„ ì˜ˆì•½ ì‹œ ë™ì‹œì„± ì œì–´
   - Optimistic Lock: í¬ì¸íŠ¸ ì°¨ê° ì‹œ ë²„ì „ ì¶©ëŒ ê°ì§€

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

- [ARCHITECTURE.md](./ARCHITECTURE.md) - ì•„í‚¤í…ì²˜ ìƒì„¸ ì„¤ëª…
- [SEQUENCE_DIAGRAM.md](./SEQUENCE_DIAGRAM.md) - API ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨
- [schema.sql](./schema.sql) - ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
